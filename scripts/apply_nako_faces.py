#!/usr/bin/env python3
"""
Update story.json with faceId based on the script directions.
Replaces 'chara' property with 'faceId' and applies correct expression numbers.
"""
import json

# Load story
with open('scenarios/nako/story.json', 'r', encoding='utf-8') as f:
    story = json.load(f)

# Expression mapping from script (text pattern -> faceId)
# We'll apply faceId based on the台本指示

# Scene 2 mappings
face_updates = {
    # Scene 2: 爆誕、ひまわりメイド
    "s2_01": 4,   # 光が収まり、ニュートラル
    "s2_02": 4,   # 維持
    "s2_03": 4,   # 「…………」通常
    "s2_04": 4,   # 俺のセリフ維持
    "s2_05": 1,   # 「……パァッ！！」大歓喜
    "s2_06": 1,   # 維持
    "s2_07": 1,   # 「あーりーがーとー」大歓喜
    "s2_08": 3,   # 「人間さん！」ワクワク
    "s2_09": 3,   # ガバッ
    "s2_10": 3,   # 俺セリフ維持
    "s2_11": 17,  # 「ひまわりですから！」ドヤ顔
    "s2_12": 11,  # 「いやぁ、助かりました！」にっこり
    "s2_13": 3,   # 「なこって呼んでください！」ワクワク
    "s2_14": 3,   # 俺セリフ維持
    "s2_15": 17,  # 「愛（お水）を受けて」ドヤ顔
    "s2_16": 3,   # 「運命です！」ワクワク
    "s2_17": 10,  # 「なんでもやります！」不敵
    "s2_18": 13,  # 俺セリフ後→困惑・疑問
    "s2_19": 13,  # 維持
    "s2_20": 3,   # 「植えてください！」ワクワク
    "s2_21": 11,  # 「一途なんです」にっこり
    "s2_22": 3,   # キラキラした目ワクワク
    "s2_23": 3,   # 維持
    "s2_24": 3,   # 維持
    "choice1": 3, # 選択肢

    # BAD1a: 野生へ帰れ
    "bad1a_01": 3,
    "bad1a_02": 3,   # ワクワク（すぐに前向きに）
    "bad1a_03": 3,
    "bad1a_04": 3,
    "bad1a_05": 3,
    "bad1a_06": 3,
    "bad1a_07": 20,  # 呆然
    "bad1a_08": 8,   # 怒り
    "bad1a_09": 5,   # ジト目
    "bad1a_10": 7,   # 落胆・泣き
    "bad1a_11": 7,

    # BAD1b: 重すぎる契約
    "bad1b_01": 3,
    "bad1b_02": 14,  # 驚き
    "bad1b_03": 3,   # 感動ワクワク
    "bad1b_04": 1,   # 大歓喜
    "bad1b_05": 11,  # にっこり
    "bad1b_06": 11,
    "bad1b_07": 11,
    "bad1b_08": 13,  # 困惑
    "bad1b_09": 17,  # ドヤ顔
    "bad1b_10": 17,
    "bad1b_11": 17,
    "bad1b_12": 17,
    "bad1b_13": 17,
    "bad1b_14": 10,  # 不敵
    "bad1b_15": 10,

    # BAD1c: デリカシー欠如
    "bad1c_01": 3,
    "bad1c_02": 3,
    "bad1c_03": 16,  # 驚き
    "bad1c_04": 8,   # 怒り
    "bad1c_05": 8,
    "bad1c_06": 8,
    "bad1c_07": 13,  # 困惑
    "bad1c_08": 8,   # 怒り
    "bad1c_09": 15,  # 静かな怒り
    "bad1c_10": 15,
    "bad1c_11": 15,

    # TRUE1: なし崩し同居
    "t1_01": 3,
    "t1_02": 3,
    "t1_03": 13,  # 困惑
    "t1_04": 3,   # ワクワク
    "t1_05": 3,
    "t1_06": 17,  # ドヤ顔
    "t1_07": 3,   # ワクワク
    "t1_08": 3,
    "t1_09": 3,
    "t1_10": 10,  # 不敵
    "t1_11": 10,
    "t1_12": 10,
    "t1_13": 10,
    "t1_14": 10,
    "t1_15": 10,
    "t1_16": 10,
    "t1_17": 1,   # 大歓喜

    # Scene 3: 暴力的な朝陽
    "s3_01": 1,
    "s3_02": 1,
    "s3_03": 1,
    "s3_04": 1,
    "s3_05": 1,
    "s3_06": 1,   # 朝からハイテンション
    "s3_07": 3,   # 太陽への興奮
    "s3_08": 3,
    "s3_09": 3,
    "s3_10": 3,
    "s3_11": 3,
    "s3_12": 5,   # ジト目ツッコミ
    "s3_13": 17,  # ドヤ顔
    "s3_14": 17,
    "s3_15": 11,  # にっこり伸び
    "s3_16": 4,   # 通常（大真面目）
    "s3_17": 4,
    "s3_18": 4,
    "s3_19": 11,  # にっこり満足
    "s3_20": 3,   # ワクワク
    "s3_21": 3,
    "s3_22": 8,   # 不満
    "s3_23": 8,
    "s3_24": 10,  # 不敵ドヤ
    "s3_25": 10,
    "s3_26": 17,  # ドヤ顔
    "s3_27": 17,
    "s3_28": 3,   # ワクワク
    "s3_29": 3,
    "s3_30": 3,
    "s3_31": 3,

    # Scene 4: 透明なメインディッシュ
    "s4_01": 11,  # にっこりスタンバイ
    "s4_02": 11,
    "s4_03": 17,  # ドヤ顔ババーン
    "s4_04": 17,
    "s4_05": 17,
    "s4_06": 17,
    "s4_07": 10,  # 不敵
    "s4_08": 17,  # ドヤ顔
    "s4_09": 5,   # ジト目（なんでわからないの）
    "s4_10": 17,  # ドヤ顔
    "s4_11": 3,   # ワクワク
    "s4_12": 11,  # にっこりあーん
    "s4_13": 11,
    "s4_14": 11,
    "s4_15": 11,
    "s4_16": 11,
    "choice2": 11,

    # BAD2a: 過剰摂取
    "bad2a_01": 11,
    "bad2a_02": 14,  # 驚き
    "bad2a_03": 13,  # 困惑
    "bad2a_04": 10,  # 不敵
    "bad2a_05": 3,   # ワクワク
    "bad2a_06": 3,
    "bad2a_07": 3,
    "bad2a_08": 3,
    "bad2a_09": 3,

    # BAD2b: 現実的な怒り
    "bad2b_01": 8,   # 怒り
    "bad2b_02": 8,
    "bad2b_03": 19,  # 不機嫌
    "bad2b_04": 15,  # 静かな怒り
    "bad2b_05": 12,  # 邪悪な笑み
    "bad2b_06": 12,
    "bad2b_07": 12,

    # BAD2c: 強すぎる光
    "bad2c_01": 16,  # 驚き赤面
    "bad2c_02": 16,
    "bad2c_03": 16,
    "bad2c_04": 13,  # おろおろ
    "bad2c_05": 9,   # ごまかし
    "bad2c_06": 18,  # 小悪魔
    "bad2c_07": 11,  # にっこり覚悟
    "bad2c_08": 11,
    "bad2c_09": 11,
    "bad2c_10": 2,   # 驚き呆然
    "bad2c_11": 2,
    "bad2c_12": 2,
    "bad2c_13": 2,
    "bad2c_14": 2,
    "bad2c_15": 2,
    "bad2c_16": 2,

    # TRUE2: 巧みな誘導
    "t2_01": 11,
    "t2_02": 14,  # 驚き発見
    "t2_03": 14,
    "t2_04": 3,   # ワクワク使命感
    "t2_05": 3,
    "t2_06": 3,
    "t2_07": 11,  # にっこり感動
    "t2_08": 1,   # 大歓喜
    "t2_09": 1,
    "t2_10": 1,
    "t2_11": 3,   # ワクワク（声は楽しそう）
    "t2_12": 3,
    "t2_13": 3,
    "t2_14": 3,
    "t2_15": 3,

    # Scene 5: 夜に咲く、一瞬の花
    "s5_01": 7,   # 落胆
    "s5_02": 7,
    "s5_03": 4,   # 通常
    "s5_04": 4,
    "s5_05": 7,   # 落胆
    "s5_06": 4,   # 通常
    "s5_07": 4,
    "s5_08": 4,
    "s5_09": 9,   # ごまかし
    "s5_10": 7,   # 落胆
    "s5_11": 4,   # 通常寂しげ
    "s5_12": 4,
    "s5_13": 13,  # 困惑・疑問
    "s5_14": 13,
    "s5_15": 13,
    "s5_16": 13,
    "s5_17": 13,
    "s5_18": 3,   # ワクワク（火花）
    "s5_19": 3,
    "s5_20": 3,
    "s5_21": 11,  # にっこり
    "s5_22": 11,
    "s5_23": 4,   # 通常
    "s5_24": 7,   # 落胆儚い
    "s5_25": 7,
    "s5_26": 4,   # 通常寂しげ
    "s5_27": 4,
    "s5_28": 4,
    "s5_29": 4,
    "choice3": 4,

    # BAD3a: デリカシー欠如
    "bad3a_01": 8,   # 怒り涙目
    "bad3a_02": 8,
    "bad3a_03": 7,   # 落胆
    "bad3a_04": 8,   # 怒り
    "bad3a_05": 8,
    "bad3a_06": 8,
    "bad3a_07": None,  # 立ち絵なし

    # BAD3b: 雰囲気ブレイカー
    "bad3b_01": 5,   # ジト目
    "bad3b_02": 5,
    "bad3b_03": 5,
    "bad3b_04": 19,  # 不機嫌
    "bad3b_05": 5,   # ジト目
    "bad3b_06": 5,
    "bad3b_07": None,

    # BAD3c: 禁忌の言葉
    "bad3c_01": 4,   # 通常（止まる）
    "bad3c_02": 4,
    "bad3c_03": 4,
    "bad3c_04": 6,   # サイコパス
    "bad3c_05": 6,
    "bad3c_06": 6,
    "bad3c_07": 15,  # 静かな怒り
    "bad3c_08": 15,
    "bad3c_09": 6,   # サイコパス
    "bad3c_10": 6,
    "bad3c_11": 6,
    "bad3c_12": 6,
    "bad3c_13": 6,
    "bad3c_14": 6,
    "bad3c_15": 20,  # 呆然
    "bad3c_16": 20,
    "bad3c_17": 20,

    # TRUE3: ひと夏の約束
    "t3_01": 16,  # 驚き
    "t3_02": 16,
    "t3_03": 11,  # にっこり涙拭い
    "t3_04": 11,
    "t3_05": 1,   # 大歓喜
    "t3_06": 11,  # にっこり愛おしそう
    "t3_07": 11,
    "t3_08": 11,
    "t3_09": 11,
    "t3_10": 4,   # 通常感謝
    "t3_11": 1,   # 大歓喜最高笑顔
    "t3_12": 11,  # にっこり穏やか
    "t3_13": 18,  # 小悪魔いたずら
    "t3_14": 11,  # にっこり約束
    "t3_15": 11,
    "t3_16": 11,
    "t3_17": 11,
    "t3_18": 11,
    "t3_19": 11,
    "t3_20": 11,
    "t3_21": 11,
    "t3_22": None, # 消えた
    "t3_23": None,
    "t3_24": None,
    "t3_25": None,
    "t3_26": None,
    "t3_27": None,
    "t3_28": None,

    # Epilogue
    "ep_01": None,
    "ep_02": None,
    "ep_03": None,
    "ep_04": None,
    "ep_05": None,
    "ep_06": None,
    "ep_07": None,
    "ep_08": None,
    "ep_09": None,
    "ep_10": 1,  # 登場
    "ep_11": 1,  # 大歓喜
    "ep_12": 1,
    "ep_13": 1,
    "ep_14": 1,
    "ep_15": 1,
    "ep_16": 17,  # ドヤ顔
    "ep_17": 17,
    "true_end": 17,
}

# Apply updates
for node_id, face_id in face_updates.items():
    if node_id in story:
        # Remove old chara property
        if 'chara' in story[node_id]:
            del story[node_id]['chara']
        # Set faceId (None means no face)
        if face_id is not None:
            story[node_id]['faceId'] = face_id

# Save
with open('scenarios/nako/story.json', 'w', encoding='utf-8') as f:
    json.dump(story, f, ensure_ascii=False, indent=4)

print(f"Updated {len(face_updates)} nodes with faceId!")
